WSTICSEFF                                                       15-JAN-1997 13:38:12    DEC Fortran V6.2-508                Page   1
                                                                29-JUL-1996 16:15:16    SMS1:[WIND.SOFTWARE.STICS]WSTICSEFF.FOR;18

	      1      	SUBROUTINE WSTICSEFF(ENERGY, MASS,			!input 
	      2      .					DCRR, TCRF, DCRF)	!output
	      3 C*****************************************************************************************
	      4 C
	      5 C	This subroutine returns TCR/FSR, DCR/FSR AND DCR/RSR efficiencies 
	      6 C	for a given mass.  It uses data from tables that were generated from
	      7 C       calibration data.
	      8 C	For masses not in data files the program interpolates between masses
	      9 C	available.
	     10 C
	     11 C	this is essentially PHAEFF but using different tables.  
	     12 C
	     13 C	CMSCEFF.FOR	created		17-NOV-1993
	     14 C
	     15 C       This version is modified for WIND-STICS:
	     16 C		WSTICSEFF.FOR 	created 27-JUL-1995	by	K. CHOTOO
	     17 C
	     18 C	Revision History:
	     19 C	 1-AUG-1995	K. CHOTOO	Added Fe data file from interpolation
	     20 C					between Ar and Kr. All data files from
	     21 C					C - Kr have the same E/nuc values.
	     22 C
	     23 C     	25-AUG-1995  	ABG 		No Ne_95.eff file available, so
	     24 C					interopolate from Ar and O
	     25 C
	     26 C	 7-FEB-1995  	K.CHOTOO	Ne_95.eff file now avalible. Same as C,N,O_95.eff
	     27 C
	     28 C	17-APR-1995	K.CHOTOO	Replaced FRS/Io with DCR/RSR in this routine and
	     29 C					in efficiency data files
	     30 C
	     31 C=========================================================================================
	     32 C
	     33 C  Input:
	     34 C
	     35 C	Energy 		Real		the total energy of the particle in 
	     36 C					keV upon entering the detector
	     37 C
	     38 C	Mass		Real		the mass of the particle in amu
	     39 C
	     40 C  Output:
	     41 C
	     42 C	DCRR		Real		the dcr/rsr START efficiency for that mass
	     43 C					and energy
	     44 C
	     45 C	TCRF		Real		the tcr/fsr STOP efficiency for that mass
	     46 C					and energy
	     47 C
	     48 C	DCRF		Real		the dcr/fsr STOP efficiency for that mass
	     49 C					and energy
	     50 C
	     51 C***************************************************************************
	     52 C
	     53 C			DECLARATIONS
	     54 C			************
	     55 C
	     56      	IMPLICIT NONE
	     57 C

WSTICSEFF                                                       15-JAN-1997 13:38:12    DEC Fortran V6.2-508                Page   2
                                                                29-JUL-1996 16:15:16    SMS1:[WIND.SOFTWARE.STICS]WSTICSEFF.FOR;18

	     58 C			input
	     59      	REAL
	     60      .	  ENERGY,
	     61      .	  MASS
	     62 C
	     63 C			data available
	     64       	REAL
	     65      .	  M(9)/1.000,3.971,11.916,13.896,15.872,20.019,39.631,55.404,83.135/,
	     66 C				aval data mass -  H,He,C,N,O,Ne,Ar,Kr
	     67 C				have Ne data but not used in interpolation
	     68      .	  TCRF,						!tcr/fsr
	     69      .	  DCRF,						!dcr/fsr
	     70      .	  DCRR						!dcr/rsr
	     71 C
	     72 C
	     73      	CHARACTER*5
	     74      .	  HEADER					!text in data files
	     75 C
	     76      	CHARACTER*9
	     77      .	  DATFILE(9)/'H_95.EFF','HE_95.EFF','C_95.EFF','N_95.EFF',
	     78      .		   'O_95.EFF','NE_95.EFF','AR_95.EFF','FE_95.EFF','KR_95.EFF'/
	     79 C							!data files
	     80 C
	     81      	CHARACTER*28
	     82      .	  DIR/'SMS1:[CHOTOO.WIND_STICS_EFF]'/	!location of files
	     83 C
	     84 C			possible masses
	     85      	REAL
	     86      .	  REALM,					!real ion mass
	     87      .	  ACTLM(13)/1.000,3.971,11.916,13.896,15.872,20.019,	!possible ions
	     88      .		22.808,24.112,27.863,31.810,39.631,55.404,83.135/,
	     89 C			!H,HE,C,N,O,NE,NA,MG,SI,S,AR,FE,KR
	     90      .	  DELTA,					!input mass - real mass
	     91      .	  MIN						!minimum difference
	     92 C
	     93 C			interpolation
	     94      	LOGICAL
	     95      .	  INTERP					!must interpolate
	     96 C
	     97 C			interpolation by energy
	     98      	REAL
	     99      .	  EPM,
	    100      .	  DATA(4),					!file data values
	    101      .	  ELO, EHI,					!energy values
	    102      .	  DLO, DHI,					!eff values
	    103      .	  TLO, THI,					!eff values
	    104      .	  FLO, FHI,					!eff values
	    105      .	  DEFF,TEFF,FEFF				!interpolated value
	    106 C
	    107 C			interpolation by mass
	    108      	REAL
	    109      .	  DATA1(4),					!2nd file data
	    110      .	  E1LO, E1HI,					!energy values
	    111      .	  D1LO, D1HI,					!eff values
	    112      .	  T1LO, T1HI,					!eff values
	    113      .	  F1LO, F1HI,					!eff values
	    114      .	  DEFF1,TEFF1,FEFF1,				!interpolated value

WSTICSEFF                                                       15-JAN-1997 13:38:12    DEC Fortran V6.2-508                Page   3
                                                                29-JUL-1996 16:15:16    SMS1:[WIND.SOFTWARE.STICS]WSTICSEFF.FOR;18

	    115      .	  M1, M2					!interp. masses
	    116 C
	    117 C
	    118      	INTEGER
	    119      .	  I,J
	    120 C
	    121 C***************************************************************************
	    122 C
	    123 C			STATEMENTS
	    124 C			**********
	    125 C					initialization
	    126 C
	    127      	INTERP = .FALSE.
	    128      	MIN = 100
	    129 C						find the real mass for this ion
	    130 C						by finding the real ion mass
	    131 C						it is closest to
	    132      	DO I = 1, 13
	    133      	  DELTA = ABS(MASS - ACTLM(I))
	    134      	  IF (DELTA.LT.MIN) THEN
	    135      	    MIN = DELTA
	    136      	    REALM = ACTLM(I)
	    137      	  END IF
	    138      	END DO
	    139 C
	    140      	EPM = ENERGY/REALM
	    141 C						find if interpolation is
	    142 C						necessary or if we have this
	    143 C						ion.  open approp. files
	    144      	DO I = 1, 8
	    145      	  IF ((REALM.LT.M(I+1)) .AND. (REALM.GT.M(I))) THEN
	    146      	    OPEN (UNIT=1, FILE=DIR//DATFILE(I), STATUS='OLD', READONLY)
	    147      	    REWIND 1
	    148      	    M1 = M(I)
	    149      	    OPEN (UNIT=5, FILE=DIR//DATFILE(I+1), STATUS='OLD', READONLY)
	    150      	    REWIND 5
	    151      	    M2 = M(I+1)
	    152      	    INTERP = .TRUE.
	    153      	  ELSE IF (REALM.EQ.M(I)) THEN		!have this ion
	    154      	    OPEN (UNIT=1, FILE=DIR//DATFILE(I), STATUS='OLD',READONLY)
	    155      	    REWIND 1
	    156      	  END IF
	    157      	END DO
	    158      	IF (REALM.EQ.M(9)) THEN
	    159      	  OPEN (UNIT=1, FILE=DIR//DATFILE(8), STATUS='OLD', READONLY)
	    160      	  REWIND 1
	    161      	END IF
	    162      	IF (REALM.GT.M(9)) THEN			!shouldn't happen
	    163      	  DCRR = 1.0
	    164      	  TCRF = 1.0
	    165      	  DCRF = 1.0
	    166      	  RETURN
	    167      	END IF
	    168 C
	    169  555   	IF (INTERP) THEN			!interpolation necessary
	    170      	  DO I = 1, 2
	    171      	    READ(1,'(A)') HEADER		!skip headers

WSTICSEFF                                                       15-JAN-1997 13:38:12    DEC Fortran V6.2-508                Page   4
                                                                29-JUL-1996 16:15:16    SMS1:[WIND.SOFTWARE.STICS]WSTICSEFF.FOR;18

	    172       	    READ(5,'(A)') HEADER
	    173      	  END DO
	    174 C						first file - low mass
	    175      	  ELO = 10000
	    176      	  DO WHILE (EPM.LT.ELO)		!finding energy rng - E is
	    177      	    EHI = ELO				!decreasing in file
	    178      	    DHI = DLO
	    179      	    THI = TLO
	    180      	    FHI = FLO
	    181      	    READ(1,*,END=5555) (DATA(I), I=1,4)	!low ion data
	    182      	    ELO = DATA(1)
	    183      	    DLO = DATA(2)
	    184      	    TLO = DATA(3)
	    185      	    FLO = DATA(4)
	    186      	  END DO
	    187 C						energy interpolation
	    188      	  DEFF = ((DHI-DLO)/(EHI-ELO))*(EPM-ELO) + DLO
	    189      	  TEFF = ((THI-TLO)/(EHI-ELO))*(EPM-ELO) + TLO
	    190      	  FEFF = ((FHI-FLO)/(EHI-ELO))*(EPM-ELO) + FLO
	    191 
	    192 
	    193 C
	    194 C						second file - high mass
	    195  1111	  E1LO = 10000
	    196  	  DO WHILE (EPM.LT.E1LO)		!finding energy rng
	    197      	    E1HI = E1LO
	    198      	    D1HI = D1LO
	    199      	    T1HI = T1LO
	    200      	    F1HI = F1LO
	    201      	    READ(5,*,END=6666) (DATA1(I), I=1,4)	!high ion data
	    202      	    E1LO = DATA1(1)
	    203      	    D1LO = DATA1(2)
	    204      	    T1LO = DATA1(3)
	    205      	    F1LO = DATA1(4)
	    206      	  END DO
	    207 C						energy interpolation
	    208      	  DEFF1 = ((D1HI-D1LO)/(E1HI-E1LO))*(EPM-E1LO) + D1LO
	    209      	  TEFF1 = ((T1HI-T1LO)/(E1HI-E1LO))*(EPM-E1LO) + T1LO
	    210      	  FEFF1 = ((F1HI-F1LO)/(E1HI-E1LO))*(EPM-E1LO) + F1LO
	    211 
	    212 C
	    213 C						mass interpolation
	    214  2222  	  DCRF = ((DEFF1-DEFF)/(M2-M1)) * (REALM-M1) + DEFF
	    215  	  TCRF = ((TEFF1-TEFF)/(M2-M1)) * (REALM-M1) + TEFF
	    216  	  DCRR = ((FEFF1-FEFF)/(M2-M1)) * (REALM-M1) + FEFF
	    217      	ELSE					!have this ion
	    218      	  DO I = 1, 2
	    219      	    READ(1,'(A)') HEADER		!skip headers
	    220      	  END DO
	    221      	  ELO = 10000
	    222      	  DO WHILE (EPM.LT.ELO)
	    223      	    EHI = ELO
	    224      	    DHI = DLO
	    225      	    THI = TLO
	    226      	    FHI = FLO
	    227      	    READ(1,*,END=8888) (DATA(I), I=1,4)
	    228      	    ELO = DATA(1)

WSTICSEFF                                                       15-JAN-1997 13:38:12    DEC Fortran V6.2-508                Page   5
                                                                29-JUL-1996 16:15:16    SMS1:[WIND.SOFTWARE.STICS]WSTICSEFF.FOR;18

	    229      	    DLO = DATA(2)
	    230      	    TLO = DATA(3)
	    231      	    FLO = DATA(4)
	    232      	  END DO
	    233      	  DCRF = ((DHI-DLO)/(EHI-ELO))*(EPM-ELO) + DLO
	    234      	  TCRF = ((THI-TLO)/(EHI-ELO))*(EPM-ELO) + TLO
	    235      	  DCRR = ((FHI-FLO)/(EHI-ELO))*(EPM-ELO) + FLO
	    236      	END IF     					!interp
	    237 C
	    238  3333	REWIND 1
	    239      	IF (INTERP) REWIND 5
	    240 C
	    241      	CLOSE(UNIT=1)
	    242      	IF (INTERP) CLOSE(UNIT=5)
	    243 C
	    244      	RETURN
	    245 C
	    246  5555   DEFF = DLO				!at end of first file
	    247      	TEFF = TLO				!at end of first file
	    248      	FEFF = FLO				!at end of first file
	    249      	GO TO 1111
	    250 C 	
	    251  6666   DEFF1 = D1LO				!at end of second file
	    252      	TEFF1 = T1LO				!at end of second file
	    253      	FEFF1 = F1LO				!at end of second file
	    254      	GO TO 2222
	    255  8888   DCRF = DLO				!at end of only file
	    256      	TCRF = TLO				!at end of only file
	    257      	DCRR = FLO				!at end of only file
	    258      	GO TO 3333
	    259      	END

WSTICSEFF                                                       15-JAN-1997 13:38:12    DEC Fortran V6.2-508                Page   6
                                Symbol Table                    29-JUL-1996 16:15:16    SMS1:[WIND.SOFTWARE.STICS]WSTICSEFF.FOR;18



PROGRAM SECTIONS

    Name				 Bytes   Attributes

  1 $DATA$                                 208 NOPIC CON REL LCL NOSHR NOEXE   RD   WRT OCTA
  2 $BSS$                                  112 NOPIC CON REL LCL NOSHR NOEXE   RD   WRT OCTA
  3 $IODATA$                                36 NOPIC CON REL LCL NOSHR NOEXE   RD   WRT OCTA
  4 $CODE$                                3324   PIC CON REL LCL   SHR   EXE NORD NOWRT OCTA
  5 $LINK$                                 308 NOPIC CON REL LCL NOSHR NOEXE   RD NOWRT OCTA

    Total Space Allocated                 3988


ENTRY POINTS

    Address   Type  Name     
                             
  4-00000000        WSTICSEFF


VARIABLES

    Address   Type  Name       Address   Type  Name       Address   Type  Name       Address   Type  Name  
                                                                                                           
  2-00000030  R*4   D1HI     2-00000028  R*4   E1HI     2-00000024  R*4   FHI      2-00000008  R*4   REALM 
  2-0000002C  R*4   D1LO   REG-00000025  R*4   E1LO     2-00000020  R*4   FLO      2-00000038  R*4   T1HI  
      **      R*4   DCRF     2-0000000C  R*4   EHI      2-00000000  CHAR  HEADER   2-00000034  R*4   T1LO  
      **      R*4   DCRR   REG-########  R*4   ELO    REG-########  I*4   I            **      R*4   TCRF  
REG-00000029  R*4   DEFF         **      R*4   ENERGY REG-00000006  L*4   INTERP REG-00000022  R*4   TEFF  
REG-0000002D  R*4   DEFF1  REG-00000023  R*4   EPM      2-0000004C  I*4   J      REG-0000002E  R*4   TEFF1 
REG-0000002B  R*4   DELTA    2-00000040  R*4   F1HI     2-00000044  R*4   M1       2-0000001C  R*4   THI   
  2-00000014  R*4   DHI      2-0000003C  R*4   F1LO     2-00000048  R*4   M2       2-00000018# R*4   TLO   
  1-00000000  CHAR  DIR    REG-00000028  R*4   FEFF         **      R*4   MASS                             
  2-00000010# R*4   DLO    REG-0000002F  R*4   FEFF1  REG-00000020  R*4   MIN                              


ARRAYS

     Address  Type  Name           Bytes  Dimensions

  1-00000044  R*4   ACTLM             52  (13)
  2-00000050  R*4   DATA              16  (4)
  2-00000060  R*4   DATA1             16  (4)
  1-00000078  CHAR  DATFILE           81  (9)
  1-00000020  R*4   M                 36  (9)




WSTICSEFF                                                       15-JAN-1997 13:38:12    DEC Fortran V6.2-508                Page   7
                                Symbol Table                    29-JUL-1996 16:15:16    SMS1:[WIND.SOFTWARE.STICS]WSTICSEFF.FOR;18

LABELS

    Address   Label     Address   Label     Address   Label     Address   Label
                                                                               
      **       555    4-00000938   2222   4-00000710   5555   4-00000B28   8888
  4-00000788   1111   4-00000BAC   3333   4-00000998   6666                    

WSTICSEFF                                                       15-JAN-1997 13:38:12    DEC Fortran V6.2-508                Page   8
                                Symbol Table                    29-JUL-1996 16:15:16    SMS1:[WIND.SOFTWARE.STICS]WSTICSEFF.FOR;18



  +---------------------------------------------------+
  |               KEY TO ADDRESS CODE FORMATS         |
  |   ppp-oooooooo  - In Psect ppp, Offset oooooooo   |
  |   ***-********  - External                        |
  |               # - Suffix: Also In Registers       |
  |   REG-rrrrrrrr  - In Register rrrrrrrr            |
  |   REG-########  - In Various Registers            |
  |        **       - Not Used; Not Allocated         |
  +---------------------------------------------------+


COMMAND QUALIFIERS

  /ALIGNMENT=(COMMONS=(PACKED,NOMULTILANGUAGE),RECORDS=NATURAL)
  /ASSUME=(ACCURACY_SENSITIVE,BACKSLASH,NODUMMY_ALIASES,NOUNDERSCORE)
  /CHECK=(NOASSERTIONS,BOUNDS,FORMAT,NOFP_EXCEPTIONS,NOOVERFLOW,NOUNDERFLOW)
  /DEBUG=(NOSYMBOLS,TRACEBACK)
  /DESIGN=(NOCOMMENTS)
  /SHOW=(NODICTIONARY,NOINCLUDE,MAP,NOPREPROCESSOR)
  /STANDARD=(NOSEMANTIC,NOSOURCE_FORM,NOSYNTAX)
  /WARNINGS=(ALIGNMENT,NOARGUMENT_CHECKING,NODECLARATIONS,GENERAL,NOTRUNCATED_SOURCE,UNCALLED,
             UNINITIALIZED,UNREACHABLE,UNUSED)
  /NOAUTOMATIC  /BLAS=NOMAPPED  /CONVERT=NATIVE  /NOCROSS_REFERENCE  /NOD_LINES  /ERROR_LIMIT=30  /EXTEND_SOURCE
  /NOPAD_SOURCE  /NOF77  /FLOAT=G_FLOAT  /IEEE_MODE=FAST  /ROUNDING_MODE=NEAREST
  /GRANULARITY=QUADWORD  /INSTRUCTION_SET=FLOATING  /INTEGER_SIZE=32  /NOMACHINE_CODE
  /MATH_LIBRARY=ACCURATE  /NAMES=UPPERCASE  /OPTIMIZE=(LEVEL=4,UNROLL=0)  /REAL_SIZE=32  /NORECURSIVE
  /NOSEPARATE_COMPILATION  /NOSYNCHRONOUS_EXCEPTIONS  /NOSYNTAX_ONLY  /TERMINAL=NOSTATISTICS  /NOTIE  /VMS
  /NOANALYSIS_DATA
  /NODIAGNOSTICS
  /INCLUDE=(.FOR,.f,FORT$INCLUDE:.FOR,FORT$INCLUDE:.f)
  /LIST=SMS1:[WIND.SOFTWARE.STICS]WSTICSEFF.LIS;8
  /OBJECT=SMS1:[WIND.SOFTWARE.STICS]WSTICSEFF.OBJ;9
  /NOLIBRARY
   sys$lib=SYS$COMMON:[SYSLIB]FORSYSDEF.TLB;1

COMPILER: DEC Fortran V6.2-508-274F

COMPILATION STATISTICS

  CPU time:          1.20 seconds
  Elapsed time:      2.92 seconds
  Pagefaults:         326
  I/O Count:           15
