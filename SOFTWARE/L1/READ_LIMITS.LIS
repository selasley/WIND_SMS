READ_LIMITS                                                      4-DEC-1995 15:25:16    DEC Fortran V6.2-508                Page   1
                                                                21-NOV-1995 16:38:45    SMS1:[WIND.SOFTWARE.L1]READ_LIMITS.FOR;15

	      1 	SUBROUTINE READ_LIMITS(ENTITY,MAX_ENTITY,NUM_READ,NUM_ENABLED)
	      2  
	      3 C+
	      4 C 
	      5 C FUNCTIONAL DESCRIPTION:	
	      6 C 
	      7 C    This subroutine reads the limits file (default filename LIMITS.DAT),
	      8 C    parses its contents, and loads up the array ENTITY with information about
	      9 C    each of the instrument's parameters.
	     10 C
	     11 C FORMAL PARAMETERS:
	     12 C  
	     13 C     ENTITY:
	     14 C	  An array of MAX_ENTITY structures of type HOUSEKEEPING_STATS.  Each
	     15 C	  element in the array contains a strcture describing a single
	     16 C	  instrument parameter.
	     17 C      
	     18 C     MAX_ENTITY:
	     19 C	  The number of elements in the array ENTITY.
	     20 C      
	     21 C     NUM_READ:
	     22 C	  An integer variable which upon return will contain a count of the
	     23 C	  number of instrument parameters that were read into the array ENTITY.
	     24 C      
	     25 C     NUM_ENABLED:
	     26 C	  An integer variable which upon return will contain a count of the
	     27 C	  number of instrument parameters whose limits will be checked.
	     28 C  
	     29 C COMMON BLOCKS:
	     30 C  
	     31 C     None
	     32 C  
	     33 C DESIGN:
	     34 C  
	     35 C     Initialize ENTITY array to have large MIN_VALUE, small MAX_VALUE
	     36 C     Open LIMITS file and read it; for each line
	     37 C       Decode line
	     38 C       If reporting to be enabled save lower, upper limits
	     39 C     Close file
	     40 C  
	     41 C     Location of limits file can be redirected at runtime by defining the
	     42 C       logical name LIMITS.  If not defined filename defaults to LIMITS.DAT.
	     43 C  
	     44 C 
	     45 C This version:   1.2   21-NOV-1995
	     46 C 
	     47 C Created: 
	     48 C 
	     49 C	 14-NOV-1995    Larry Bleau
	     50 C 
	     51 C Revised:
	     52 C 
	     53 C	 Date     | Name  | Description
	     54 C ----------------+-------+-----------------------------------------------------
	     55 C 17-NOV-1995 1.1 |  LRB  | Add loop to initialize ENTITY array
	     56 C 21-NOV-1995 1.2 |  LRB  | fixed code to extract units, decode limits
	     57 C

READ_LIMITS                                                      4-DEC-1995 15:25:16    DEC Fortran V6.2-508                Page   2
                                                                21-NOV-1995 16:38:45    SMS1:[WIND.SOFTWARE.L1]READ_LIMITS.FOR;15

	     58 C-
	     59 CDEC$	IDENT  '1.2'
	     60 	IMPLICIT NONE
	     61 	INCLUDE 'INC_DIR:EDBDEF.INC/NOLIST'

READ_LIMITS                                                      4-DEC-1995 15:25:16    DEC Fortran V6.2-508                Page   3
1.2                                                             21-NOV-1995 16:38:45    SMS1:[WIND.SOFTWARE.L1]READ_LIMITS.FOR;15

	    599 	INCLUDE 'INC_DIR:LIMITDEF.INC/NOLIST'
	    648 	INTEGER MAX_ENTITY,NUM_READ,NUM_ENABLED
	    649 	RECORD /HOUSEKEEPING_STATS/ ENTITY(MAX_ENTITY)
	    650 C
	    651 	INTEGER LIM_LUN,LIB$GET_LUN
	    652 	INTEGER STATUS,FORTERR,RMSSTS,RMSSTV,LUNIT,CONDVAL
	    653 	INTEGER LINENO,NCH,IDX
	    654 	CHARACTER LINE*132,NAME*40
	    655 	LOGICAL ENABLED
	    656 C
	    657 C Initialize ENTITY array, setting the REPORT field to .FALSE., MIN_VALUE to a
	    658 C large number, and MAX_VALUE to a small number
	    659 C
	    660 	DO IDX=1,MAX_ENTITY
	    661 	  ENTITY(IDX).REPORT = .FALSE.
	    662 	  ENTITY(IDX).MIN_VALUE = 99999.
	    663 	  ENTITY(IDX).MAX_VALUE = -99999.
	    664 	END DO
	    665 C
	    666 C Get a unit number and open the limits file
	    667 C
	    668 	STATUS = LIB$GET_LUN (LIM_LUN)
	    669 	IF (STATUS .NE. 1) GOTO 9010
	    670 C
	    671 	OPEN (
	    672 	1 UNIT=LIM_LUN,
	    673 	1 FILE = 'LIMITS',
	    674 	1 STATUS = 'OLD',
	    675 	1 CARRIAGECONTROL = 'LIST',
	    676 	1 DEFAULTFILE = '.DAT',
	    677 	1 READONLY,
	    678 	1 ERR = 9000,
	    679 	1 IOSTAT = STATUS)
	    680 	LINENO = 0
	    681 	NUM_READ = 0
	    682 	NUM_ENABLED = 0
	    683 C
	    684 C Read each line of the file and process it.
	    685 C If it starts with a "!" or is empty, ignore the line and read the next one.
	    686 C Otherwise decode the line into the proper data structures.
	    687 C The format of the input line is
	    688 C
	    689 C                Column   Size
	    690 C Field name   Position  (Chars)  Format  Meaning                           
	    691 C ===========  ========  =======  ======  =============================     
	    692 C Index (#)         1      3       I3     a unique identifying number for this
	    693 C                                         parameter; DO NOT CHANGE THIS!!!
	    694 C Parameter         5     40       A40    the descriptive name of the parameter
	    695 C Lower            46      9       F9.2   lower limit; lowest "good" value
	    696 C Upper            57      9       F9.2   upper limit; highest "good" value
	    697 C Units            68      4       A4     the units of this parameter
	    698 C Check?           77      1       A1     whether of not to check this
	    699 C                                         parameter against its upper and lower
	    700 C                                         limits; must be Y or N
	    701 C 
	    702 100	READ(LIM_LUN,101,END=500,ERR=500) NCH,LINE
	    703 101	FORMAT(Q,A)

READ_LIMITS                                                      4-DEC-1995 15:25:16    DEC Fortran V6.2-508                Page   4
1.2                                                             21-NOV-1995 16:38:45    SMS1:[WIND.SOFTWARE.L1]READ_LIMITS.FOR;15

	    704 	LINENO = LINENO + 1
	    705 	IF (NCH .EQ. 0) GOTO 100
 C	    706 D	type 1004,lineno,line(1:nch)
 C	    707 D1004	format(' Line ',i3,': "',a,'"')
	    708 	IF (LINE(1:1) .EQ. '!') GOTO 100
	    709 	ENABLED = LINE(77:77) .EQ. 'Y' .OR. LINE(77:77) .EQ. 'y' 
 C	    710 D	enabled = .true.
	    711 	READ(LINE,102,ERR=400) IDX,NAME
	    712 102	FORMAT(I3,T5,A40)
	    713 	IF (IDX .GT. MAX_ENTITY) GOTO 100
	    714 	NUM_READ = NUM_READ + 1
	    715 	ENTITY(IDX).IDENT = NAME
	    716 	ENTITY(IDX).COUNT = 0
	    717 	ENTITY(IDX).NZERO = 0
	    718 	ENTITY(IDX).UNITS = LINE(68:71)
	    719 	IF (.NOT. ENABLED) GOTO 100
	    720 C
	    721 	IF (LINE(46:54) .EQ. ' ') GOTO 100
	    722 	READ(LINE(46:54),*,ERR=400) ENTITY(IDX).LO_LIMIT
	    723 C103	FORMAT(T46,F9.2)
	    724 	IF (LINE(57:65) .EQ. ' ') GOTO 100
	    725 	READ(LINE(57:65),*,ERR=400) ENTITY(IDX).HI_LIMIT
	    726 C104	FORMAT(T57,F9.2)
	    727 	ENTITY(IDX).REPORT = .TRUE.
	    728 	ENTITY(IDX).LO_COUNT = 0
	    729 	ENTITY(IDX).HI_COUNT = 0
 C	    730 D	type 105,idx,entity(idx).ident,entity(idx).lo_limit,entity(idx).hi_limit,
 C	    731 D	1 entity(idx).units
 C	    732 D105	format(1x,i3,1x,a40,'|',2f10.2,2x,a)
	    733 	NUM_ENABLED = NUM_ENABLED + 1
	    734 	GOTO 100
	    735 C
	    736 400	TYPE *,'FORMAT ERROR READING LIMITS FILE; LINE # ',LINENO,', LINE='
	    737 	TYPE *,LINE(1:NCH)
	    738 	TYPE *,'LINE IGNORED'
	    739 	GOTO 100
	    740 C
	    741 C Done; close file, release unit number, and return
	    742 C
	    743 500	CLOSE(LIM_LUN)
	    744 	CALL LIB$FREE_LUN (LIM_LUN)
	    745 	type *,'NUM_READ    =',NUM_READ
	    746 	type *,'NUM_ENABLED =',NUM_ENABLED
	    747 	RETURN
	    748 C
	    749 C Come here for errors
	    750 C
	    751 9000	TYPE *,'ERROR OPENING LIMITS FILE, STATUS=',STATUS
	    752 	CALL ERRSNS (FORTERR, RMSSTS, RMSSTV, LUNIT, CONDVAL)
	    753 	CALL EXIT(RMSSTS)
	    754 C
	    755 9010	TYPE *,'ERROR ALLOCATING UNIT NUMBER'
	    756 	CALL EXIT(STATUS)
	    757 	END

READ_LIMITS                                                      4-DEC-1995 15:25:16    DEC Fortran V6.2-508                Page   5
1.2                             Symbol Table                    21-NOV-1995 16:38:45    SMS1:[WIND.SOFTWARE.L1]READ_LIMITS.FOR;15



PROGRAM SECTIONS

    Name				 Bytes   Attributes

  1 $BSS$                                  208 NOPIC CON REL LCL NOSHR NOEXE   RD   WRT OCTA
  2 $IODATA$                                36 NOPIC CON REL LCL NOSHR NOEXE   RD   WRT OCTA
  3 $CODE$                                2128   PIC CON REL LCL   SHR   EXE NORD NOWRT OCTA
  4 $LINK$                                 606 NOPIC CON REL LCL NOSHR NOEXE   RD NOWRT OCTA

    Total Space Allocated                 2978


ENTRY POINTS

    Address   Type  Name       
                               
  3-00000000        READ_LIMITS


VARIABLES

    Address   Type  Name            Address   Type  Name            Address   Type  Name            Address   Type  Name       
                                                                                                                               
  1-00000014  I*4   CONDVAL       1-00000048  CHAR  LINE          1-00000018  I*4   NCH           0-00000048  I*4   STATUS     
REG-0000000A  L*4   ENABLED       0-0000003C# I*4   LINENO            **      I*4   NUM_ENABLED                                
  1-00000004  I*4   FORTERR       1-00000010  I*4   LUNIT             **      I*4   NUM_READ                                   
  0-00000038# I*4   IDX               **      I*4   MAX_ENTITY    1-00000008  I*4   RMSSTS                                     
  1-00000000# I*4   LIM_LUN       1-00000020  CHAR  NAME          1-0000000C  I*4   RMSSTV                                     


RECORD ARRAYS

    Address   Name    Structure                  Bytes  Dimensions

      **      ENTITY  HOUSEKEEPING_STATS           **  (*)



LABELS

    Address   Label     Address   Label     Address   Label     Address   Label
                                                                               
  3-00000298   100        **       102        **       500        **       9010
      **       101        **       400    3-00000000   9000                    



READ_LIMITS                                                      4-DEC-1995 15:25:16    DEC Fortran V6.2-508                Page   6
1.2                             Symbol Table                    21-NOV-1995 16:38:45    SMS1:[WIND.SOFTWARE.L1]READ_LIMITS.FOR;15

FUNCTIONS AND SUBROUTINES REFERENCED

  Type  Name                 Type  Name              
                                                     
        LIB$FREE_LUN         I*4   LIB$GET_LUN       

READ_LIMITS                                                      4-DEC-1995 15:25:16    DEC Fortran V6.2-508                Page   7
1.2                             Symbol Table                    21-NOV-1995 16:38:45    SMS1:[WIND.SOFTWARE.L1]READ_LIMITS.FOR;15



  +---------------------------------------------------+
  |               KEY TO ADDRESS CODE FORMATS         |
  |   ppp-oooooooo  - In Psect ppp, Offset oooooooo   |
  |   ***-********  - External                        |
  |               # - Suffix: Also In Registers       |
  |   REG-rrrrrrrr  - In Register rrrrrrrr            |
  |   REG-########  - In Various Registers            |
  |        **       - Not Used; Not Allocated         |
  +---------------------------------------------------+


COMMAND QUALIFIERS

  /ALIGNMENT=(COMMONS=(PACKED,NOMULTILANGUAGE),RECORDS=PACKED)
  /ASSUME=(ACCURACY_SENSITIVE,BACKSLASH,NODUMMY_ALIASES,NOUNDERSCORE)
  /CHECK=(ASSERTIONS,BOUNDS,FORMAT,FP_EXCEPTIONS,OVERFLOW,ÿÿÿ°&¶
  /DEBUG=(NOSYMBOLS,TRACEBACK)
  /DESIGN=(NOCOMMENTS)
  /SHOW=(NODICTIONARY,NOINCLUDE,MAP,NOPREPROCESSOR)
  /STANDARD=(NOSEMANTIC,NOSOURCE_FORM,NOSYNTAX)
  /WARNINGS=(NOALIGNMENT,NOARGUMENT_CHECKING,DECLARATIONS,GENERAL,NOTRUNCATED_SOURCE,UNCALLED,
             UNINITIALIZED,UNREACHABLE,UNUSED)
  /NOAUTOMATIC  /BLAS=NOMAPPED  /CONVERT=NATIVE  /NOCROSS_REFERENCE  /NOD_LINES  /ERROR_LIMIT=30  /EXTEND_SOURCE
  /NOPAD_SOURCE  /NOF77  /FLOAT=G_FLOAT  /IEEE_MODE=FAST  /ROUNDING_MODE=NEAREST
  /GRANULARITY=QUADWORD  /INSTRUCTION_SET=FLOATING  /INTEGER_SIZE=32  /NOMACHINE_CODE
  /MATH_LIBRARY=ACCURATE  /NAMES=UPPERCASE  /OPTIMIZE=(LEVEL=4,UNROLL=0)  /REAL_SIZE=32  /NORECURSIVE
  /NOSEPARATE_COMPILATION  /NOSYNCHRONOUS_EXCEPTIONS  /NOSYNTAX_ONLY  /TERMINAL=NOSTATISTICS  /NOTIE  /VMS
  /NOANALYSIS_DATA
  /NODIAGNOSTICS
  /INCLUDE=(.FOR,.f,FORT$INCLUDE:.FOR,FORT$INCLUDE:.f)
  /LIST=SMS1:[WIND.SOFTWARE.L1]READ_LIMITS.LIS;15
  /OBJECT=SMS1:[WIND.SOFTWARE.L1]READ_LIMITS.OBJ;13
  /NOLIBRARY
   sys$lib=SYS$COMMON:[SYSLIB]FORSYSDEF.TLB;1

COMPILER: DEC Fortran V6.2-508-274F

COMPILATION STATISTICS

  CPU time:          0.99 seconds
  Elapsed time:      2.76 seconds
  Pagefaults:         266
  I/O Count:           21
