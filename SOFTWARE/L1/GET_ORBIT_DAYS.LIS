GET_ORBIT_DAYS                                                   2-JUN-1995 20:16:10    DEC Fortran V6.2-508                Page   1
                                                                 2-JUN-1995 14:03:29    SMS1:[WIND.SOFTWARE.L1]GET_ORBIT_DAYS.FOR;14

	      1         SUBROUTINE get_orbit_days(beg_date, end_date, what_pos, maxsize,
	      2      1		nstored, epoch_arr, gci_pos_arr, gci_vel_arr, gse_pos_arr,
	      3      1		gse_vel_arr, gsm_pos_arr, gsm_vel_arr, sun_vec_arr)
	      4  
	      5 C+
	      6 C 
	      7 C FUNCTIONAL DESCRIPTION:	
	      8 C 
	      9 C    
	     10 C    This routine returns all requested orbit information for a given time
	     11 C    frame, which is an interval between two dates.
	     12 C
	     13 C 
	     14 C FORMAL PARAMETERS:
	     15 C  
	     16 C     BEG_DATE:
	     17 C	  REAL*8    The date/time, in Epoch format, of the first position
	     18 C		    requested.
	     19 C      
	     20 C     END_DATE:
	     21 C	  REAL*8    The date/time, in Epoch format, of the last position
	     22 C		    requested.
	     23 C      
	     24 C     WHAT_POS:
	     25 C	  LOG*4	    A 7-element logical array.  Each element indicates to
	     26 C		    GET_ORBIT_DAYS what information the calling program
	     27 C		    requires.  The elements, in order, are:
	     28 C			1   GCI position
	     29 C			2   GCI velocity
	     30 C			3   GSE position
	     31 C			4   GSE velocity
	     32 C			5   GSM position
	     33 C			6   GSM velocity
	     34 C			7   Sun vector
	     35 C		    If a particular element is .TRUE. the corresponding position
	     36 C		    (or velocity) information is stored in its argument.
	     37 C      
	     38 C     MAXSIZE:
	     39 C	  INT*4	    The maximum number of elements in each of the arrays
	     40 C		    GCI_POS_ARR, GCI_VEL_ARR, GSE_POS_ARR, GSE_POS_ARR,
	     41 C		    GSM_POS_ARR, GSM_POS_ARR, and SUN_VEC_ARR. 
	     42 C      
	     43 C     NSTORED:
	     44 C	  INT*4	    The number of positions actually stored in each of the
	     45 C		    arrays GCI_POS_ARR, GCI_VEL_ARR, GSE_POS_ARR, GSE_POS_ARR,
	     46 C		    GSM_POS_ARR, GSM_POS_ARR, and SUN_VEC_ARR. 
	     47 C
	     48 C     EPOCH_ARR:
	     49 C     	  REAL*8    An array of MAXSIZE elements containing the Epoch times.
	     50 C		    The first NSTORED elements contain Epoch times associated
	     51 C		    with the corresponding position and velocity values stored
	     52 C		    in the remaining arguments.
	     53 C	
	     54 C     GCI_POS_ARR:
	     55 C	  /EPHEMERIS/	An array of MAXSIZE RECORDs of structure type /EPHEMERIS/.
	     56 C		    The first NSTORED elements contain positions in GCI
	     57 C		    coordinates which were retrieved from the CDF data file. 

GET_ORBIT_DAYS                                                   2-JUN-1995 20:16:10    DEC Fortran V6.2-508                Page   2
                                                                 2-JUN-1995 14:03:29    SMS1:[WIND.SOFTWARE.L1]GET_ORBIT_DAYS.FOR;14

	     58 C      
	     59 C     GCI_VEL_ARR:
	     60 C	  /EPHEMERIS/	An array of MAXSIZE RECORDs of structure type /EPHEMERIS/.
	     61 C		    The first NSTORED elements contain velocities in GCI
	     62 C		    coordinates which were retrieved from the CDF data file. 
	     63 C      
	     64 C     GSE_POS_ARR:
	     65 C	  /EPHEMERIS/	An array of MAXSIZE RECORDs of structure type /EPHEMERIS/.
	     66 C		    The first NSTORED elements contain positions in GSE
	     67 C		    coordinates which were retrieved from the CDF data file. 
	     68 C      
	     69 C     GSE_VEL_ARR:
	     70 C	  /EPHEMERIS/	An array of MAXSIZE RECORDs of structure type /EPHEMERIS/.
	     71 C		    The first NSTORED elements contain velocities in GSE
	     72 C		    coordinates which were retrieved from the CDF data file. 
	     73 C      
	     74 C     GSM_POS_ARR:
	     75 C	  /EPHEMERIS/	An array of MAXSIZE RECORDs of structure type /EPHEMERIS/.
	     76 C		    The first NSTORED elements contain positions in GSM
	     77 C		    coordinates which were retrieved from the CDF data file. 
	     78 C      
	     79 C     GSM_VEL_ARR:
	     80 C	  /EPHEMERIS/	An array of MAXSIZE RECORDs of structure type /EPHEMERIS/.
	     81 C		    The first NSTORED elements contain velocities in GSM
	     82 C		    coordinates which were retrieved from the CDF data file. 
	     83 C      
	     84 C     SUN_VEC_ARR:
	     85 C	  /EPHEMERIS/	An array of MAXSIZE RECORDs of structure type /EPHEMERIS/.
	     86 C		    The first NSTORED elements contain positions in GCI sun
	     87 C		    vector coordinates which were retrieved from the CDF data
	     88 C		    file.  
	     89 C
	     90 C  
	     91 C COMMON BLOCKS:
	     92 C  
	     93 C     EPHDATA	  where routine GET_EPHEMERIS stores the position and velocity
	     94 C     		  data it reads from the CDF; defined in L1_HDR_INFO.INC
	     95 C  
	     96 C DESIGN:
	     97 C  
	     98 C     convert Epoch times into dates
	     99 C     construct name of CDF file
	    100 C     read data from CDF file
	    101 C     move data from COMMON into proper parts of arrays
	    102 C     check if beyond ending date; if not repeat previous two steps
	    103 C  
	    104 C 
	    105 C This version:    1-JUN-1995	  1.0
	    106 C 
	    107 C Created: 
	    108 C 
	    109 C	 1-JUN-1995    Larry Bleau
	    110 C 
	    111 C Revised:
	    112 C 
	    113 C	 Date     | Name  | Description
	    114 C ----------------+-------+-----------------------------------------------------

GET_ORBIT_DAYS                                                   2-JUN-1995 20:16:10    DEC Fortran V6.2-508                Page   3
                                                                 2-JUN-1995 14:03:29    SMS1:[WIND.SOFTWARE.L1]GET_ORBIT_DAYS.FOR;14

	    115 C [change_entry]
	    116 C 
	    117 C-
	    118 CDEC$	IDENT '1.0'
	    119 	IMPLICIT NONE
	    120 	INCLUDE 'INC_DIR:EPHDEF.INC'
	    152 	INCLUDE 'INC_DIR:L1_HDR_INFO.INC'
	    186 	INCLUDE '($RMSDEF)'
	    897 	REAL*8 beg_date,end_date
	    898 	LOGICAL*4 what_pos(7)
	    899 	INTEGER*4 maxsize,nstored
	    900 	REAL*8 epoch_arr(maxsize)
	    901 	RECORD /EPHEMERIS/ gci_pos_arr(maxsize), gci_vel_arr(maxsize),
	    902 	1 gse_pos_arr(maxsize), gse_vel_arr(maxsize), gsm_pos_arr(maxsize),
	    903 	1 gsm_vel_arr(maxsize), sun_vec_arr(maxsize)
	    904 C
	    905 	INTEGER*4 year, month, day, hour, minute, second, msec, store_here, i
	    906 	INTEGER*4 status, context, ncor, lib$find_file, lib$find_file_end, nleft
	    907 	CHARACTER or_pattern*39,or_name*80
	    908 	REAL*8 this_date
	    909 C
	    910 	this_date = beg_date
	    911 	store_here = 1
	    912 	nstored = 0
	    913 C
	    914 C Start loop.  Process a day at a time, copying data into arrays starting at
	    915 C store_here.  Stop when we:
	    916 C 1) reach the ending date specified by end_date, or
	    917 C 2) run out of space in the array to store the data
	    918 C
	    919 	DO WHILE (this_date .le. end_date .and. nstored .lt. maxsize)
	    920 C 
	    921 C Convert Epoch time into date format
	    922 C
	    923 	    call epoch_breakdown(this_date, year, month, day, hour, minute,
	    924 	1     second, msec)
	    925 C
	    926 C Determine the name of the first ORbit data file for this day.
	    927 C This assumes there is only one version of the orbit file present for this
	    928 C date.  If there is more than one this code will use the first file, which may
	    929 C not be the one desired.
	    930 C
	    931 	    write(or_pattern,1001) year,month,day
	    932 1001	    format('WIND_OR_DATA:WI_OR_DEF_',I4.4,I2.2,I2.2,'_V%%.CDF')
	    933 	    context = 0
	    934 	    status = lib$find_file (or_pattern, or_name, context, , , ,)
	    935 	    if (status .eq. rms$_normal) then	    ! we found a file
	    936 		ncor = index( or_name, '.CDF;' ) - 1
	    937 	    else
	    938 		goto 500			    ! no file, next day
	    939 	    endif
	    940 	    status = lib$find_file_end(context)
 C	    941 D	type *,'reading from ',or_name(1:ncor)
	    942 C
	    943 C Now that we have a CDF filename call the routine GET_EPHEMERIS to read orbit
	    944 C data from the CDF.  It puts it in common block EPHDATA.  The blank second
	    945 C argument tells it we don't want attitude information.

GET_ORBIT_DAYS                                                   2-JUN-1995 20:16:10    DEC Fortran V6.2-508                Page   4
1.0                                                              2-JUN-1995 14:03:29    SMS1:[WIND.SOFTWARE.L1]GET_ORBIT_DAYS.FOR;14

	    946 C 
	    947 	    call get_ephemeris(or_name(1:ncor), ' ', status)
	    948 C
	    949 C Now copy the requested information from the common block into the caller's
	    950 C arrays at the correct position.
	    951 C
	    952 	    nleft = maxsize - store_here + 1
	    953 	    DO i=1,MIN(nleft,144)
	    954 		epoch_arr(store_here) = eph_epoch(i)
	    955 		IF (what_pos(1)) gci_pos_arr(store_here) = gci_pos(i)
	    956 		IF (what_pos(2)) gci_vel_arr(store_here) = gci_vel(i)
	    957 		IF (what_pos(3)) gse_pos_arr(store_here) = gse_pos(i)
	    958 		IF (what_pos(4)) gse_vel_arr(store_here) = gse_vel(i)
	    959 		IF (what_pos(5)) gsm_pos_arr(store_here) = gsm_pos(i)
	    960 		IF (what_pos(6)) gsm_vel_arr(store_here) = gsm_vel(i)
	    961 		IF (what_pos(7)) sun_vec_arr(store_here) = gci_sun_vector(i)
	    962 		store_here = store_here + 1
	    963 	    END DO
	    964 	    nstored = store_here - 1
	    965 C
	    966 C Done copying orbit data for this day; increment Epoch time by one day and test
	    967 C if we're done.  If not, loop back and get next day's orbit data.
	    968 C	    
	    969 500	    this_date = this_date + 24*60*60*1E3
	    970 	ENDDO
	    971 C
	    972 	RETURN
	    973 	END

GET_ORBIT_DAYS                                                   2-JUN-1995 20:16:10    DEC Fortran V6.2-508                Page   5
1.0                             Symbol Table                     2-JUN-1995 14:03:29    SMS1:[WIND.SOFTWARE.L1]GET_ORBIT_DAYS.FOR;14



PROGRAM SECTIONS

    Name				 Bytes   Attributes

  1 $BSS$                                  184 NOPIC CON REL LCL NOSHR NOEXE   RD   WRT OCTA
  2 $IODATA$                                60 NOPIC CON REL LCL NOSHR NOEXE   RD   WRT OCTA
  3 $CODE$                                3508   PIC CON REL LCL   SHR   EXE NORD NOWRT OCTA
  4 $LINK$                                 246 NOPIC CON REL LCL NOSHR NOEXE   RD NOWRT OCTA
  5 EPHDATA                              29376 NOPIC OVR REL GBL NOSHR NOEXE   RD   WRT OCTA

    Total Space Allocated                33374


ENTRY POINTS

    Address   Type  Name          
                                  
  3-00000000        GET_ORBIT_DAYS


VARIABLES

    Address   Type  Name           Address   Type  Name           Address   Type  Name           Address   Type  Name      
                                                                                                                           
      **      R*8   BEG_DATE         **      I*4   MAXSIZE          **      I*4   NSTORED      1-00000000  R*8   THIS_DATE 
  1-00000030  I*4   CONTEXT      1-00000018  I*4   MINUTE       1-00000068  CHAR  OR_NAME      1-00000008  I*4   YEAR      
  1-00000010  I*4   DAY          1-0000000C  I*4   MONTH        1-00000040  CHAR  OR_PATTERN                               
      **      R*8   END_DATE     1-00000020  I*4   MSEC         1-0000001C  I*4   SECOND                                   
  1-00000014  I*4   HOUR         1-00000034  I*4   NCOR         1-0000002C  I*4   STATUS                                   
  1-00000028  I*4   I            1-00000038  I*4   NLEFT        1-00000024  I*4   STORE_HERE                               


ARRAYS

     Address  Type  Name             Bytes  Dimensions

  5-00000000  R*8   EPH_EPOCH         1152  (144)
      **      R*8   EPOCH_ARR           **  (*)
  5-00007080  R*4   SPIN_RATE          576  (144)
      **      L*4   WHAT_POS            28  (7)



RECORD ARRAYS

    Address   Name            Structure         Bytes  Dimensions

  5-00006300  GCI_ATT         ATTITUDE          1152  (144)
  5-00000480  GCI_POS         EPHEMERIS         3456  (144)
      **      GCI_POS_ARR     EPHEMERIS           **  (*)
  5-00005580  GCI_SUN_VECTOR  EPHEMERIS         3456  (144)
  5-00001200  GCI_VEL         EPHEMERIS         3456  (144)
      **      GCI_VEL_ARR     EPHEMERIS           **  (*)
  5-00006780  GSE_ATT         ATTITUDE          1152  (144)
  5-00001F80  GSE_POS         EPHEMERIS         3456  (144)

GET_ORBIT_DAYS                                                   2-JUN-1995 20:16:10    DEC Fortran V6.2-508                Page   6
1.0                             Symbol Table                     2-JUN-1995 14:03:29    SMS1:[WIND.SOFTWARE.L1]GET_ORBIT_DAYS.FOR;14

      **      GSE_POS_ARR     EPHEMERIS           **  (*)
  5-00002D00  GSE_VEL         EPHEMERIS         3456  (144)
      **      GSE_VEL_ARR     EPHEMERIS           **  (*)
  5-00006C00  GSM_ATT         ATTITUDE          1152  (144)
  5-00003A80  GSM_POS         EPHEMERIS         3456  (144)
      **      GSM_POS_ARR     EPHEMERIS           **  (*)
  5-00004800  GSM_VEL         EPHEMERIS         3456  (144)
      **      GSM_VEL_ARR     EPHEMERIS           **  (*)
      **      SUN_VEC_ARR     EPHEMERIS           **  (*)



LABELS

    Address   Label     Address   Label
                                       
  3-00000B2C   500        **       1001


FUNCTIONS AND SUBROUTINES REFERENCED

  Type  Name                      Type  Name                   
                                                               
        EPOCH_BREAKDOWN           I*4   LIB$FIND_FILE          
        GET_EPHEMERIS             I*4   LIB$FIND_FILE_END      

GET_ORBIT_DAYS                                                   2-JUN-1995 20:16:10    DEC Fortran V6.2-508                Page   7
1.0                             Symbol Table                     2-JUN-1995 14:03:29    SMS1:[WIND.SOFTWARE.L1]GET_ORBIT_DAYS.FOR;14



  +---------------------------------------------------+
  |               KEY TO ADDRESS CODE FORMATS         |
  |   ppp-oooooooo  - In Psect ppp, Offset oooooooo   |
  |   ***-********  - External                        |
  |               # - Suffix: Also In Registers       |
  |   REG-rrrrrrrr  - In Register rrrrrrrr            |
  |   REG-########  - In Various Registers            |
  |        **       - Not Used; Not Allocated         |
  +---------------------------------------------------+


COMMAND QUALIFIERS

  /ALIGNMENT=(COMMONS=(PACKED,NOMULTILANGUAGE),RECORDS=NATURAL)
  /ASSUME=(ACCURACY_SENSITIVE,BACKSLASH,NODUMMY_ALIASES,NOUNDERSCORE)
  /CHECK=(ASSERTIONS,BOUNDS,FORMAT,FP_EXCEPTIONS,OVERFLOW,ÿÿÿ°&¶
  /DEBUG=(SYMBOLS,TRACEBACK)
  /DESIGN=(NOCOMMENTS)
  /SHOW=(NODICTIONARY,NOINCLUDE,MAP,NOPREPROCESSOR)
  /STANDARD=(NOSEMANTIC,NOSOURCE_FORM,NOSYNTAX)
  /WARNINGS=(ALIGNMENT,NOARGUMENT_CHECKING,DECLARATIONS,GENERAL,NOTRUNCATED_SOURCE,UNCALLED,
             UNINITIALIZED,UNREACHABLE,UNUSED)
  /NOAUTOMATIC  /BLAS=NOMAPPED  /CONVERT=NATIVE  /NOCROSS_REFERENCE  /NOD_LINES  /ERROR_LIMIT=30  /EXTEND_SOURCE
  /NOPAD_SOURCE  /NOF77  /FLOAT=G_FLOAT  /IEEE_MODE=FAST  /ROUNDING_MODE=NEAREST
  /GRANULARITY=QUADWORD  /INSTRUCTION_SET=FLOATING  /INTEGER_SIZE=32  /NOMACHINE_CODE
  /MATH_LIBRARY=ACCURATE  /NAMES=UPPERCASE  /OPTIMIZE=(LEVEL=0,UNROLL=0)  /REAL_SIZE=32  /NORECURSIVE
  /NOSEPARATE_COMPILATION  /NOSYNCHRONOUS_EXCEPTIONS  /NOSYNTAX_ONLY  /TERMINAL=NOSTATISTICS  /NOTIE  /VMS
  /NOANALYSIS_DATA
  /NODIAGNOSTICS
  /INCLUDE=(.FOR,.f,FORT$INCLUDE:.FOR,FORT$INCLUDE:.f)
  /LIST=SMS1:[WIND.SOFTWARE.L1]GET_ORBIT_DAYS.LIS;16
  /OBJECT=SMS1:[WIND.SOFTWARE.L1]GET_ORBIT_DAYS.OBJ;1
  /NOLIBRARY
   sys$lib=SYS$COMMON:[SYSLIB]FORSYSDEF.TLB;1

COMPILER: DEC Fortran V6.2-508-274F

COMPILATION STATISTICS

  CPU time:          0.80 seconds
  Elapsed time:      2.48 seconds
  Pagefaults:         202
  I/O Count:           32
