WIND_HEALTH_INIT                                                21-NOV-1995 14:18:35    DEC Fortran V6.2-508                Page   1
                                                                21-NOV-1995 13:08:13    [WIND.SOFTWARE.L1]WIND_HEALTH_INIT.FOR;11

	      1 	SUBROUTINE WIND_HEALTH_INIT(L1_LUN, L1FILENAME, OUTPUTFILENAME, NCH)
	      2 
	      3 C+
	      4 C
	      5 C FUNCTIONAL DESCRIPTION:
	      6 C
	      7 C    This subroutine performs various initilization operations for the
	      8 C    WIND_HEALTH program.  Among them are:
	      9 C
	     10 C    	  Prompt user to input L1 filename
	     11 C	  Open the L1 file to unit L1_LUN, saving its header in L1_FILE_HEADER
	     12 C	  Construct the output filename, saving the name and its length in
	     13 C	    OUTPUTFILENAME and NCH
	     14 C	  Construct the summary filename and open it for output
	     15 C
	     16 C FORMAL PARAMETERS:
	     17 C
	     18 C     L1_LUN
	     19 C         An INTEGER containing the Fortran unit number on which the L1 file is
	     20 C         to be opened.
	     21 C
	     22 C     L1FILENAME
	     23 C         A CHARACTER variable which will receive the name of the input L1 file
	     24 C         selected by the user.
	     25 C
	     26 C     OUTPUTFILENAME
	     27 C         A CHARACTER variable which will receive the constructed name of the
	     28 C         output file.  The output file is not, however, opened.
	     29 C
	     30 C     NCH
	     31 C         An INTEGER variable which will receive the length of the name stored
	     32 C         in OUTPUTFILENAME.
	     33 C
	     34 C
	     35 C COMMON BLOCKS:
	     36 C
	     37 C     REPORT	  Information controlling the limit reporting feature of the
	     38 C     		  program.
	     39 C
	     40 C DESIGN:
	     41 C
	     42 C     Initialize some variables
	     43 C     Get input L1 filename
	     44 C     Construct output filename
	     45 C     Open file named after L1 file but with file type .SUMM on unit
	     46 C	WH_LUN; this will be used to hold out-of-limit messages generated while
	     47 C	processing the L1 file.
	     48 C     Open temporary file named WIND_HEALTH_BRIEF.TMP on unit WH_LUN2; this
	     49 C	will be used to hold a summary of out-of-limit messages generated while
	     50 C	processing the L1 file.  It will be mailed to a user then deleted at
	     51 C	the end of the program.
	     52 C     Keep mailing list in MAIL_LIST, length in NCHMAIL.  Get mailing list
	     53 C	at runtime by translating logical name WIND_HEALTH_MAIL; default to
	     54 C	current user if not defined.
	     55 C
	     56 C This version:   1.2   21-NOV-1995
	     57 C

WIND_HEALTH_INIT                                                21-NOV-1995 14:18:35    DEC Fortran V6.2-508                Page   2
                                                                21-NOV-1995 13:08:13    [WIND.SOFTWARE.L1]WIND_HEALTH_INIT.FOR;11

	     58 C Created:
	     59 C
	     60 C	 14-NOV-1995    Larry Bleau
	     61 C
	     62 C Revised:
	     63 C
	     64 C	 Date     | Name  | Description
	     65 C ----------------+-------+-----------------------------------------------------
	     66 C 20-NOV-1995     |  LRB  | removed explicit 0 from call to LIB$GETJPI
	     67 C 21-NOV-1995     |  LRB  | added comments; added TYPE statement displaying
	     68 C			    filename
	     69 C [change_entry]
	     70 C
	     71 C-
	     72 CDEC$	IDENT  '1.2'
	     73 	IMPLICIT NONE
	     74 	INCLUDE	'INC_DIR:EDBDEF.INC/NOLIST'

WIND_HEALTH_INIT                                                21-NOV-1995 14:18:35    DEC Fortran V6.2-508                Page   3
1.2                                                             21-NOV-1995 13:08:13    [WIND.SOFTWARE.L1]WIND_HEALTH_INIT.FOR;11

	    612 	INCLUDE 'INC_DIR:L1FMT.INC/NOLIST'
	    744 	INCLUDE '($JPIDEF)/NOLIST'
	    965 C
	    966 C Parameter declarations
	    967 C
	    968 	CHARACTER*(*) L1FILENAME,OUTPUTFILENAME
	    969 	INTEGER L1_LUN,NCH,NCH2
	    970 C
	    971         INTEGER STATUS,FORTERR,RMSSTC,RMSSTV,LUN,VAXERR
	    972 	INTEGER DEVDIR_LEN, IPOS
	    973 	CHARACTER*80 DEVDIR,BRIEF
	    974 	CHARACTER*30 TEMPNAME/'SYS$LOGIN:WIND_HEALTH_MAIL.TMP'/
	    975 	CHARACTER USERNAME*12
	    976 	INTEGER*2 UNCH
	    977 C
	    978 C COMMON blocks
	    979 C
	    980 	INTEGER WH_LUN,WH_LUN2,NEXCEED,NCHL1,NCHMAIL,GET_LOGICAL,LIB$GETJPI
	    981 	CHARACTER*80 L1NAME,MAIL_LIST
	    982 	COMMON /REPORT/ WH_LUN,WH_LUN2,L1NAME,NCHL1,NEXCEED,MAIL_LIST,NCHMAIL
	    983 C
	    984 C Initialize some variables
	    985 C
	    986 	WH_LUN = 15
	    987 	WH_LUN2 = 16
	    988 	NEXCEED = 0
	    989 	NCHMAIL = GET_LOGICAL( 'WIND_HEALTH_MAIL', MAIL_LIST)
	    990 	IF (NCHMAIL .EQ. 0) THEN
	    991 	  STATUS = LIB$GETJPI( JPI$_USERNAME, ,,, USERNAME, UNCH)
	    992 	  MAIL_LIST = USERNAME
	    993 	  NCHMAIL = INDEX(MAIL_LIST, ' ') - 1
	    994 	ENDIF
	    995 C
	    996 C Get input L1 filename
	    997 C
	    998 	L1FILENAME = 'DATA_DIR:WI*L1*.DAT'
	    999 	CALL WIND_GET_FILENAME(L1FILENAME, STATUS)
	   1000 	IF (STATUS .NE .1) STOP
	   1001 C
	   1002 C Open L1 file for input
	   1003 C
	   1004 	CALL WIND_L1_OPEN( L1_LUN, L1FILENAME, L1_FILE_HEADER, STATUS)
	   1005 	IF (STATUS .NE. 1) GOTO 9010
	   1006 	L1NAME = L1FILENAME
	   1007 	NCHL1 = INDEX(L1NAME, ' ') - 1
	   1008 	IF (NCHL1 .EQ. -1) NCHL1 = LEN(L1NAME)
	   1009 C
	   1010 C Construct output filenames
	   1011 C
	   1012 C There are three output files: a detailed report of the instrument's health
	   1013 C (called the output file) which has a file extension of .HEALTH; a summary of
	   1014 C parameters whose value exceeds their limits (called a summary file) which has
	   1015 C a file extension of .SUMM; and file listing only the names of the parameters
	   1016 C whose value exceeds their limits (call the mail file or message file) which
	   1017 C has a file extension of .TMP and is located in the user's login directory.
	   1018 C
	   1019 C Only the first two files are patterned after the input L1 file; the message

WIND_HEALTH_INIT                                                21-NOV-1995 14:18:35    DEC Fortran V6.2-508                Page   4
1.2                                                             21-NOV-1995 13:08:13    [WIND.SOFTWARE.L1]WIND_HEALTH_INIT.FOR;11

	   1020 C file has a fixed name.  Both the detail file and summary file filenames are
	   1021 C constructed here.  The summary and message files are both opened here.  The
	   1022 C detail file is not opened here; it is opened by the main routine.
	   1023 C
	   1024 C Create output file each time to keep info from diffrent runs separate
	   1025 C Construct output filename from the L1 filename and make it reside in the
	   1026 C current directory.  Change the file extension to .HEALTH for most
	   1027 C cases.  For NRT data, where the extension is not .DAT but serves to
	   1028 C distinguish different data sets, make the extension part of the filename (see
	   1029 C case 2 below) and add .HEALTH as the new extension.
	   1030 C
	   1031 C Do the same operations to construct the summary filename, but give it a file
	   1032 C type of.SUMM .
	   1033 C
	   1034 C     L1 filename                  detail report filename
	   1035 C 1)  WI_L1_SMS_yyyymmdd_Vvv.DAT   WI_L1_SMS_yyyymmdd_Vvv.HEALTH
	   1036 C 2)  WI_L1_SMS_yyyymmdd_Vvv.kkkk  WI_L1_SMS_yyyymmdd_Vvv_kkkk.HEALTH
	   1037 C 3)  yymmdd_Vvv.DAT               yymmdd_Vvv.HEALTH
	   1038 C
	   1039 	OUTPUTFILENAME = L1FILENAME
	   1040 	IPOS = INDEX( OUTPUTFILENAME, ';' )		! strip off version #
	   1041 	IF (IPOS .NE. 0) OUTPUTFILENAME(IPOS:) = ' '
	   1042 	NCH = INDEX( OUTPUTFILENAME, ' ') - 1		! get # of chars
	   1043 	IF (IPOS .EQ. -1) NCH = LEN(OUTPUTFILENAME)
	   1044 	IPOS = INDEX( OUTPUTFILENAME, ']' )		! extract device, directory
	   1045 	IF (IPOS .NE. 0) THEN
	   1046 	  DEVDIR = OUTPUTFILENAME(1:IPOS)		! save device/directory
	   1047 	  DEVDIR_LEN = IPOS
	   1048 	  OUTPUTFILENAME = OUTPUTFILENAME(IPOS+1:)
	   1049 	  NCH = NCH - IPOS
	   1050 	ELSE
	   1051 	  DEVDIR = '[]'
	   1052 	  DEVDIR_LEN = 2
	   1053 	ENDIF
	   1054 	BRIEF = OUTPUTFILENAME
	   1055 	IPOS = INDEX( OUTPUTFILENAME, '.' )		! locate file type
	   1056 	IF (IPOS .EQ. 0) THEN				! none, add one
	   1057 	  OUTPUTFILENAME(NCH+1:NCH+7) = '.HEALTH'
	   1058 	  BRIEF(NCH+1:NCH+5) = '.SUMM'
	   1059 	  IPOS = NCH + 1
	   1060 	  NCH2 = NCH + 5
	   1061 	  NCH = NCH + 7
	   1062 	ELSE						! if .DAT just replace
	   1063 	  IF (OUTPUTFILENAME(IPOS:IPOS+3) .EQ. '.DAT' .AND. IPOS+3 .EQ. NCH) THEN
	   1064 	    OUTPUTFILENAME(IPOS:IPOS+6) = '.HEALTH'
	   1065 	    BRIEF(IPOS:IPOS+4) = '.SUMM'
	   1066 	    NCH = IPOS + 6
	   1067 	    NCH2 = IPOS + 4
	   1068 	  ELSE						! not .DAT, keep file type
	   1069 	    OUTPUTFILENAME(IPOS:IPOS) = '_'		! combine it with filename
	   1070 	    OUTPUTFILENAME(NCH+1:NCH+7) = '.HEALTH'	! and use standard file type
	   1071 	    BRIEF(IPOS:IPOS) = '_'			! same with filename
	   1072 	    BRIEF(NCH+1:NCH+13) = '.SUMM'		! stored in BRIEF
	   1073 	    NCH2 = NCH + 5
	   1074 	    IPOS = NCH + 1
	   1075 	    NCH = NCH + 7
	   1076 	  ENDIF

WIND_HEALTH_INIT                                                21-NOV-1995 14:18:35    DEC Fortran V6.2-508                Page   5
1.2                                                             21-NOV-1995 13:08:13    [WIND.SOFTWARE.L1]WIND_HEALTH_INIT.FOR;11

	   1077 	ENDIF
 C	   1078 D	type *,'detail report name  = "',outputfilename(1:nch),'"'
 C	   1079 D	type *,'summary report name = "',brief(1:nch2),'"'
 C	   1080 D	type *,'device/direcory = "',devdir(1:devdir_len),'"'
	   1081 C
	   1082 C Open file named after L1 file but with file type .SUMM on unit WH_LUN
	   1083 C This will be used to hold out-of-limit messages generated while processing
	   1084 C the L1 file.
	   1085 C
	   1086 	TYPE *,'WIND SMS instrument health summary limit report will be written to the file'
	   1087 	TYPE *,BRIEF(1:NCH2)
	   1088 	OPEN(WH_LUN, FILE=BRIEF(1:NCH2), STATUS='NEW', ERR=9020,
	   1089      &	     CARRIAGECONTROL='LIST')
	   1090 C
	   1091 C Open temporary file named WIND_HEALTH_BRIEF.TMP on unit WH_LUN2
	   1092 C This will be used to hold a summary out-of-limit messages generated while
	   1093 C processing the L1 file.  Since it will be mailed to a user and can be then
	   1094 C deleted, its name need not be patterned after the L1 file's name.
	   1095 C
	   1096 	OPEN(WH_LUN2, FILE=TEMPNAME, STATUS='NEW', ERR=9020,
	   1097      &	     CARRIAGECONTROL='LIST')
	   1098 	RETURN
	   1099 C
	   1100 C Come here for errors
	   1101 C
	   1102 9010	TYPE *,'ERROR OPENING L1 FILE; STATUS=',STATUS
	   1103 	CALL EXIT(STATUS)
	   1104 C
	   1105 9020	TYPE *,'ERROR OPENING TEMPORARY FILE'
	   1106         CALL ERRSNS(FORTERR,RMSSTC,RMSSTV,LUN,VAXERR)
	   1107 	CALL EXIT(RMSSTC)
	   1108 	END

WIND_HEALTH_INIT                                                21-NOV-1995 14:18:35    DEC Fortran V6.2-508                Page   6
1.2                             Symbol Table                    21-NOV-1995 13:08:13    [WIND.SOFTWARE.L1]WIND_HEALTH_INIT.FOR;11



PROGRAM SECTIONS

    Name				 Bytes   Attributes

  1 $DATA$                                  32 NOPIC CON REL LCL NOSHR NOEXE   RD   WRT OCTA
  2 $BSS$                                  224 NOPIC CON REL LCL NOSHR NOEXE   RD   WRT OCTA
  3 $CODE$                                3224   PIC CON REL LCL   SHR   EXE NORD NOWRT OCTA
  4 $LINK$                                 637 NOPIC CON REL LCL NOSHR NOEXE   RD NOWRT OCTA
  5 L1_HEADERS                             644 NOPIC OVR REL GBL NOSHR NOEXE   RD   WRT OCTA
  6 REPORT                                 180 NOPIC OVR REL GBL NOSHR NOEXE   RD   WRT OCTA

    Total Space Allocated                 4941


ENTRY POINTS

    Address   Type  Name            
                                    
  3-00000000        WIND_HEALTH_INIT


VARIABLES

    Address   Type  Name               Address   Type  Name               Address   Type  Name          
                                                                                                        
  2-00000090  CHAR  BRIEF            6-00000060  CHAR  MAIL_LIST        2-0000000C  I*4   STATUS        
  2-00000040  CHAR  DEVDIR               **      I*4   NCH              1-00000000  CHAR  TEMPNAME      
  2-00000024  I*4   DEVDIR_LEN       2-00000008  I*4   NCH2             2-00000000  I*2   UNCH          
  2-00000010  I*4   FORTERR          6-00000058  I*4   NCHL1            2-00000030  CHAR  USERNAME      
  2-00000028  I*4   IPOS             6-000000B0  I*4   NCHMAIL          2-00000020  I*4   VAXERR        
      **      CHAR  L1FILENAME       6-0000005C  I*4   NEXCEED          6-00000000  I*4   WH_LUN        
  6-00000008  CHAR  L1NAME               **      CHAR  OUTPUTFILENAME   6-00000004  I*4   WH_LUN2       
      **      I*4   L1_LUN           2-00000014  I*4   RMSSTC                                           
  2-0000001C  I*4   LUN              2-00000018  I*4   RMSSTV                                           


RECORDS

    Address   Name            Structure                Bytes
                                                            
  5-00000000  L1_FILE_HEADER  ST_L1_FILE_HEADER          400
  5-00000190  L1_SR_HEADER    ST_L1_SR_HEADER            244


LABELS

    Address   Label     Address   Label
                                       
  3-00000A1C   9010   3-00000A94   9020



WIND_HEALTH_INIT                                                21-NOV-1995 14:18:35    DEC Fortran V6.2-508                Page   7
1.2                             Symbol Table                    21-NOV-1995 13:08:13    [WIND.SOFTWARE.L1]WIND_HEALTH_INIT.FOR;11

FUNCTIONS AND SUBROUTINES REFERENCED

  Type  Name                      Type  Name                   
                                                               
  I*4   GET_LOGICAL                     WIND_GET_FILENAME      
  I*4   LIB$GETJPI                      WIND_L1_OPEN           

WIND_HEALTH_INIT                                                21-NOV-1995 14:18:35    DEC Fortran V6.2-508                Page   8
1.2                             Symbol Table                    21-NOV-1995 13:08:13    [WIND.SOFTWARE.L1]WIND_HEALTH_INIT.FOR;11



  +---------------------------------------------------+
  |               KEY TO ADDRESS CODE FORMATS         |
  |   ppp-oooooooo  - In Psect ppp, Offset oooooooo   |
  |   ***-********  - External                        |
  |               # - Suffix: Also In Registers       |
  |   REG-rrrrrrrr  - In Register rrrrrrrr            |
  |   REG-########  - In Various Registers            |
  |        **       - Not Used; Not Allocated         |
  +---------------------------------------------------+


COMMAND QUALIFIERS

  /ALIGNMENT=(COMMONS=(PACKED,NOMULTILANGUAGE),RECORDS=PACKED)
  /ASSUME=(ACCURACY_SENSITIVE,BACKSLASH,NODUMMY_ALIASES,NOUNDERSCORE)
  /CHECK=(ASSERTIONS,BOUNDS,FORMAT,FP_EXCEPTIONS,OVERFLOW,ÿÿÿ°&¶
  /DEBUG=(SYMBOLS,TRACEBACK)
  /DESIGN=(NOCOMMENTS)
  /SHOW=(NODICTIONARY,NOINCLUDE,MAP,NOPREPROCESSOR)
  /STANDARD=(NOSEMANTIC,NOSOURCE_FORM,NOSYNTAX)
  /WARNINGS=(NOALIGNMENT,NOARGUMENT_CHECKING,DECLARATIONS,GENERAL,NOTRUNCATED_SOURCE,UNCALLED,
             UNINITIALIZED,UNREACHABLE,UNUSED)
  /NOAUTOMATIC  /BLAS=NOMAPPED  /CONVERT=NATIVE  /NOCROSS_REFERENCE  /NOD_LINES  /ERROR_LIMIT=30  /EXTEND_SOURCE
  /NOPAD_SOURCE  /NOF77  /FLOAT=G_FLOAT  /IEEE_MODE=FAST  /ROUNDING_MODE=NEAREST
  /GRANULARITY=QUADWORD  /INSTRUCTION_SET=FLOATING  /INTEGER_SIZE=32  /NOMACHINE_CODE
  /MATH_LIBRARY=ACCURATE  /NAMES=UPPERCASE  /OPTIMIZE=(LEVEL=0,UNROLL=0)  /REAL_SIZE=32  /NORECURSIVE
  /NOSEPARATE_COMPILATION  /NOSYNCHRONOUS_EXCEPTIONS  /NOSYNTAX_ONLY  /TERMINAL=NOSTATISTICS  /NOTIE  /VMS
  /NOANALYSIS_DATA
  /NODIAGNOSTICS
  /INCLUDE=(.FOR,.f,FORT$INCLUDE:.FOR,FORT$INCLUDE:.f)
  /LIST=SMS1:[WIND.SOFTWARE.L1]WIND_HEALTH_INIT.LIS;17
  /OBJECT=SMS1:[WIND.SOFTWARE.L1]WIND_HEALTH_INIT.OBJ;13
  /NOLIBRARY
   sys$lib=SYS$COMMON:[SYSLIB]FORSYSDEF.TLB;1

COMPILER: DEC Fortran V6.2-508-274F

COMPILATION STATISTICS

  CPU time:          1.09 seconds
  Elapsed time:      2.79 seconds
  Pagefaults:         231
  I/O Count:           32
