GET_ORBIT_REQUEST                                               22-JUN-1995 19:03:28    DEC Fortran V6.2-508                Page   1
                                                                22-JUN-1995 19:03:22    [WIND.SOFTWARE.L1]GET_ORBIT_REQUEST.FOR;13

	      1 	SUBROUTINE get_orbit_request(mode, beg_date, end_date, what_info, units,
	      2 	1 system, interval, form, output_file, nch_out) 
	      3  
	      4 C+
	      5 C 
	      6 C FUNCTIONAL DESCRIPTION:	
	      7 C 
	      8 C    This subroutine obtains information from the user about what time interval
	      9 C    should be dumped, what coordinates or velocities should be dumped, whether
	     10 C    any transformations should be performed prior to dumping, and what
	     11 C    interval to use when dumping the data.  The user is prompted for this
	     12 C    information, which is returned to the caller through the argument list.
	     13 C
	     14 C    While initially implemented as an interactive prompt this routine may
	     15 C    be changed to some other type of interface, such as command line.
	     16 C
	     17 C FORMAL PARAMETERS:
	     18 C  
	     19 C
	     20 C     MODE:
	     21 C     	  INT*4	    An encoded value indicating the mod ein which this
	     22 C		    subroutine is to run.  Currently the only mode is an
	     23 C		    interactive prompt, so this argument is ignored.
	     24 C	  
	     25 C     BEG_DATE:
	     26 C	  REAL*8    The starting date in Epoch format for which orbit
	     27 C		    information should be retrieved.
	     28 C      
	     29 C     END_DATE:
	     30 C	  REAL*8    The ending date in Epoch format for which orbit
	     31 C		    information should be retrieved.
	     32 C      
	     33 C     WHAT_INFO:
	     34 C	  LOG*4	    A 7-element logical array.  Each element indicates to
	     35 C		    what information the user requires.  The elements, in order,
	     36 C		    are: 
	     37 C			1   GCI position
	     38 C			2   GCI velocity
	     39 C			3   GSE position
	     40 C			4   GSE velocity
	     41 C			5   GSM position
	     42 C			6   GSM velocity
	     43 C			7   Sun vector
	     44 C      
	     45 C     UNITS:
	     46 C	  INT*4	    An encoded flag indicating what type of unit conversion the
	     47 C		    user wants to be performed on the data.  The possible values
	     48 C		    are: 
	     49 C			0   no conversion (leave in kilometers)
	     50 C			1   convert to Earth radii
	     51 C      
	     52 C     SYSTEM:
	     53 C	  INT*4	    An encoded flag indicating if the user wants the coordinates
	     54 C		    which are provided transformed into an alternate coordinate
	     55 C		    system.  The possible values are:
	     56 C			0   no transformation (leave in Cartesian (x,y,z))
	     57 C			1   transform to 3-D spherical (r, theta, phi)

GET_ORBIT_REQUEST                                               22-JUN-1995 19:03:28    DEC Fortran V6.2-508                Page   2
                                                                22-JUN-1995 19:03:22    [WIND.SOFTWARE.L1]GET_ORBIT_REQUEST.FOR;13

	     58 C
	     59 C     INTERVAL:
	     60 C     	  INT*4	    The length of the interval (in array elements) which is used
	     61 C		    by the display routine to dump position and velocity values.
	     62 C		    The user is prompted in minutes.  Since the data points are
	     63 C		    10 minutes apart this is the smallest interal which can be
	     64 C		    used.  Intervals are rounded up to the next whole multiple
	     65 C		    of 10 minutes then converted to array index increments by
	     66 C		    dividing by 10. 
	     67 C	  
	     68 C      
	     69 C     FORM:
	     70 C	  INT*4	    A bitmask, where each bit that is set specifies a partiuclar
	     71 C		    option.  This parameter is both input and output.
	     72 C		    Additional bits are set according to the user's responses to
	     73 C		    questions.
	     74 C      
	     75 C     OUTPUT_FILE:
	     76 C	  CHAR*(*)  The name of the user-selected output file is stored here.
	     77 C      
	     78 C     NCH_OUT:
	     79 C	  INT*4	    The number of characters in the filename in OUTPUT_FILE.
	     80 C
	     81 C COMMON BLOCKS:
	     82 C  
	     83 C     None
	     84 C  
	     85 C DESIGN:
	     86 C  
	     87 C     prompt user for start, end date, convert internally to Epoch format
	     88 C     prompt user for GCI, GSE, or GSM coords, or any combination
	     89 C     ask if user wants velocities also
	     90 C     prompt user for what conversion and/or transformation is wanted, encode
	     91 C  
	     92 C 
	     93 C This version:    8-JUN-1995	  1.1
	     94 C 
	     95 C Created: 
	     96 C 
	     97 C	 1-JUN-1995    Larry Bleau
	     98 C 
	     99 C Revised:
	    100 C 
	    101 C	 Date     | Name  | Description
	    102 C ----------------+-------+-----------------------------------------------------
	    103 C  8-JUN-1995     |  LRB  | added form, output_file, and nch_out to argument
	    104 C  			    list, construct default output filename, prompt user
	    105 C			    for filename, prompt user to use day-of-year or
	    106 C			    normal date
	    107 C [change_entry]
	    108 C 
	    109 C-
	    110 CDEC$	IDENT '1.1'

GET_ORBIT_REQUEST                                               22-JUN-1995 19:03:28    DEC Fortran V6.2-508                Page   3
1.1                                                             22-JUN-1995 19:03:22    [WIND.SOFTWARE.L1]GET_ORBIT_REQUEST.FOR;13

	    112 	IMPLICIT NONE
	    113 	INCLUDE 'WIND_POSITION.INC'
	    134 	REAL*8 beg_date, end_date
	    135 	INTEGER*4 mode, units, system, interval, form, nch_out
	    136 	LOGICAL*4 what_info(7)
	    137 	CHARACTER output_file*(*)
	    138 C
	    139 	INTEGER i, nch, nch2, year1, month1, day1, year2, month2, day2
	    140 	CHARACTER answer*80, coord(4)*10, default_name*29
	    141 	DATA coord/'GCI       ','GSE       ','GSM       ','Sun_vector'/
	    142 C
	    143 C Get starting and ending dates
	    144 C Convert the dates to Epoch format.  Fix up ending date to just before midnight
	    145 C at end of day (23:59:59) so rest of program will use entire day instead of
	    146 C stopping at the previous day.
	    147 C
	    148 100	write(*,1004) 'starting'
	    149 1004	format(' Enter ',A,' date (yyyy,mm,dd): ',$)
	    150 	read(*,*,end=900,err=100) year1,month1,day1
	    151 	call compute_epoch(year1, month1, day1, 0, 0, 0, 0, beg_date)
	    152 C
	    153 110	write(*,1004) 'ending'
	    154 	read(*,*,end=900,err=110) year2,month2,day2
	    155 	call compute_epoch(year2, month2, day2, 23, 59, 59, 0, end_date)
	    156 C
	    157 C Construct default output filename, then prompt user for output file
	    158 C
	    159 	write(default_name,1008) year1,month1,day1,year2,month2,day2
	    160 1008	format('WINDPOS_',I4.4,2I2.2,'_',I4.4,2I2.2,'.DAT')
	    161 	write(*,1009) default_name
	    162 1009	format(' Enter output filename (Return = ',A,'): ',$)
	    163 	read(*,1002) nch,answer
	    164 	IF (nch .eq. 0) THEN
	    165 	    output_file = default_name
	    166 	    nch_out = LEN(default_name)
	    167 	ELSE
	    168 	    output_file = answer(1:nch)
	    169 	    nch_out = nch
	    170 	    IF (answer(1:nch) .eq. 'SYS$OUTPUT' .or. answer .eq. 'sys$output') THEN
	    171 		output_file = 'SYS$OUTPUT:'
	    172 		nch_out = 11
	    173 	    ELSE IF (answer .eq. 'TT' .or. answer .eq. 'tt') THEN
	    174 		output_file = 'TT:'
	    175 		nch_out = 3
	    176 	    END IF
	    177 	END IF
	    178 C
	    179 C Prompt user which coordinate systems s/he wants displayed
	    180 C Also ask about velocities in each system
	    181 C Allow for a default response of No
	    182 C
	    183 	DO i=1,4
	    184 	    nch = INDEX (coord(i),' ') - 1
	    185 	    IF (nch .eq. -1) nch = LEN(coord(i))
	    186 	    write(*,1001) coord(i)(1:nch)
	    187 1001	format(' Do you want to display ',A,' position (Y/N, Return = No) ? ',$)
	    188 	    read(*,1002) nch2,answer

GET_ORBIT_REQUEST                                               22-JUN-1995 19:03:28    DEC Fortran V6.2-508                Page   4
1.1                                                             22-JUN-1995 19:03:22    [WIND.SOFTWARE.L1]GET_ORBIT_REQUEST.FOR;13

	    189 1002	format(Q,A)
	    190 	    IF (nch2 .eq. 0) answer = 'N'
	    191 	    what_info(2*(i-1)+1) = answer(1:1) .eq. 'Y' .or. answer(1:1) .eq. 'y'
	    192 	    IF (i .ne. 4) THEN
	    193 		write(*,1003) coord(i)(1:nch)
	    194 1003	format(' Do you want to display ',A,' velocities (Y/N, Return = No) ? ',$)
	    195 		read(*,1002) nch2,answer
	    196 		IF (nch2 .eq. 0) answer = 'N'
	    197 		what_info(2*(i-1)+2) = answer(1:1) .eq. 'Y' .or. answer(1:1) .eq. 'y'
	    198 	    END IF
	    199 	END DO
	    200 C
	    201 C Ask user about conversion from kilometers to other units, such as Earth radii
	    202 C
	    203 	write(*,1005)
	    204 1005	format(' Do you want to convert distances to Earth radii (Y/N,
	    205 	1 Return = No) ? ',$)
	    206 	read(*,1002) nch,answer
	    207 	IF (nch .eq. 0) answer = 'N'
	    208 	IF (answer(1:1) .eq. 'Y' .or. answer(1:1) .eq. 'y') THEN
	    209 	    units =  1
	    210 	ELSE
	    211 	    units = 0
	    212 	END IF
	    213 C
	    214 C Ask user about conversion from cartesian coordinates to spherical
	    215 C
	    216 	write(*,1006)
	    217 1006	format(' Do you want to convert to spherical coordinates (Y/N, Return = No) ? ',$)
	    218 	read(*,1002) nch,answer
	    219 	IF (nch .eq. 0) answer = 'N'
	    220 	IF (answer(1:1) .eq. 'Y' .or. answer(1:1) .eq. 'y') THEN
	    221 	    system =  1
	    222 	ELSE
	    223 	    system = 0
	    224 	END IF
	    225 C
	    226 C Ask user for sampling interval to use for dumping the data
	    227 C
	    228 200	interval = 10
	    229 	write(*,1007)
	    230 1007	format(' Interval to use to dump positions (minutes; Return = 10 min.): ',$)
	    231 	read(*,1002) nch,answer
	    232 	IF (nch .gt. 0) THEN
	    233 	    read(answer(1:nch),*,end=900,err=200) interval
	    234 	END IF
	    235 	interval = (max(interval,10) + 9) / 10
	    236 C
	    237 C Prompt user for what format date to use
	    238 C
	    239 	write(*,1010)
	    240 1010	format(' Program can display date as dd-mmm-yyyy or yyyy nnn.'/
	    241 	1 ' Do you want to display using day of year (Y/N, Return = No) ? ',$)
	    242 	read(*,1002) nch,answer
	    243 	IF (nch .eq. 0) answer = 'N'
	    244 	IF (answer(1:1) .eq. 'Y' .or. answer(1:1) .eq. 'y') THEN
	    245 	    form =  form .or. POS_FORMAT_DOY

GET_ORBIT_REQUEST                                               22-JUN-1995 19:03:28    DEC Fortran V6.2-508                Page   5
1.1                                                             22-JUN-1995 19:03:22    [WIND.SOFTWARE.L1]GET_ORBIT_REQUEST.FOR;13

	    246 	END IF
	    247 C
	    248 900	RETURN
	    249 	END


PROGRAM SECTIONS

    Name				 Bytes   Attributes

  1 $DATA$                                  40 NOPIC CON REL LCL NOSHR NOEXE   RD   WRT OCTA
  2 $BSS$                                  144 NOPIC CON REL LCL NOSHR NOEXE   RD   WRT OCTA
  3 $IODATA$                               748 NOPIC CON REL LCL NOSHR NOEXE   RD   WRT OCTA
  4 $CODE$                                3124   PIC CON REL LCL   SHR   EXE NORD NOWRT OCTA
  5 $LINK$                                 472 NOPIC CON REL LCL NOSHR NOEXE   RD NOWRT OCTA

    Total Space Allocated                 4528


ENTRY POINTS

    Address   Type  Name             
                                     
  4-00000000        GET_ORBIT_REQUEST


VARIABLES

    Address   Type  Name             Address   Type  Name             Address   Type  Name             Address   Type  Name        
                                                                                                                                   
  2-00000040  CHAR  ANSWER             **      I*4   FORM           2-00000000# I*4   NCH            2-00000008  I*4   YEAR1       
      **      R*8   BEG_DATE     REG-0000000F  I*4   I              2-00000004  I*4   NCH2           2-00000014  I*4   YEAR2       
  2-00000010  I*4   DAY1               **      I*4   INTERVAL           **      I*4   NCH_OUT                                      
  2-0000001C  I*4   DAY2               **      I*4   MODE               **      CHAR  OUTPUT_FILE                                  
  2-00000020  CHAR  DEFAULT_NAME   2-0000000C  I*4   MONTH1             **      I*4   SYSTEM                                       
      **      R*8   END_DATE       2-00000018  I*4   MONTH2             **      I*4   UNITS                                        


ARRAYS

     Address  Type  Name             Bytes  Dimensions

  1-00000000  CHAR  COORD               40  (4)
      **      L*4   WHAT_INFO           28  (7)



LABELS

    Address   Label     Address   Label     Address   Label     Address   Label     Address   Label
                                                                                                   
  4-000000A0   100    4-00000B8C   900        **       1003       **       1006       **       1009
  4-000001B8   110        **       1001       **       1004       **       1007       **       1010
  4-000009A0   200        **       1002       **       1005       **       1008                    



GET_ORBIT_REQUEST                                               22-JUN-1995 19:03:28    DEC Fortran V6.2-508                Page   6
1.1                             Symbol Table                    22-JUN-1995 19:03:22    [WIND.SOFTWARE.L1]GET_ORBIT_REQUEST.FOR;13

FUNCTIONS AND SUBROUTINES REFERENCED

  Type  Name               
                           
        COMPUTE_EPOCH      

GET_ORBIT_REQUEST                                               22-JUN-1995 19:03:28    DEC Fortran V6.2-508                Page   7
1.1                             Symbol Table                    22-JUN-1995 19:03:22    [WIND.SOFTWARE.L1]GET_ORBIT_REQUEST.FOR;13



  +---------------------------------------------------+
  |               KEY TO ADDRESS CODE FORMATS         |
  |   ppp-oooooooo  - In Psect ppp, Offset oooooooo   |
  |   ***-********  - External                        |
  |               # - Suffix: Also In Registers       |
  |   REG-rrrrrrrr  - In Register rrrrrrrr            |
  |   REG-########  - In Various Registers            |
  |        **       - Not Used; Not Allocated         |
  +---------------------------------------------------+


COMMAND QUALIFIERS

  /ALIGNMENT=(COMMONS=(PACKED,NOMULTILANGUAGE),RECORDS=NATURAL)
  /ASSUME=(ACCURACY_SENSITIVE,BACKSLASH,NODUMMY_ALIASES,NOUNDERSCORE)
  /CHECK=(ASSERTIONS,BOUNDS,FORMAT,FP_EXCEPTIONS,OVERFLOW,ÿÿÿ°&¶
  /DEBUG=(NOSYMBOLS,TRACEBACK)
  /DESIGN=(NOCOMMENTS)
  /SHOW=(NODICTIONARY,NOINCLUDE,MAP,NOPREPROCESSOR)
  /STANDARD=(NOSEMANTIC,NOSOURCE_FORM,NOSYNTAX)
  /WARNINGS=(ALIGNMENT,NOARGUMENT_CHECKING,DECLARATIONS,GENERAL,NOTRUNCATED_SOURCE,UNCALLED,
             UNINITIALIZED,UNREACHABLE,UNUSED)
  /NOAUTOMATIC  /BLAS=NOMAPPED  /CONVERT=NATIVE  /NOCROSS_REFERENCE  /NOD_LINES  /ERROR_LIMIT=30  /EXTEND_SOURCE
  /NOPAD_SOURCE  /NOF77  /FLOAT=G_FLOAT  /IEEE_MODE=FAST  /ROUNDING_MODE=NEAREST
  /GRANULARITY=QUADWORD  /INSTRUCTION_SET=FLOATING  /INTEGER_SIZE=32  /NOMACHINE_CODE
  /MATH_LIBRARY=ACCURATE  /NAMES=UPPERCASE  /OPTIMIZE=(LEVEL=4,UNROLL=0)  /REAL_SIZE=32  /NORECURSIVE
  /NOSEPARATE_COMPILATION  /NOSYNCHRONOUS_EXCEPTIONS  /NOSYNTAX_ONLY  /TERMINAL=NOSTATISTICS  /NOTIE  /VMS
  /NOANALYSIS_DATA
  /NODIAGNOSTICS
  /INCLUDE=(.FOR,.f,FORT$INCLUDE:.FOR,FORT$INCLUDE:.f)
  /LIST=SMS1:[WIND.SOFTWARE.L1]GET_ORBIT_REQUEST.LIS;14
  /OBJECT=SMS1:[WIND.SOFTWARE.L1]GET_ORBIT_REQUEST.OBJ;12
  /NOLIBRARY
   sys$lib=SYS$COMMON:[SYSLIB]FORSYSDEF.TLB;1

COMPILER: DEC Fortran V6.2-508-274F

COMPILATION STATISTICS

  CPU time:          0.97 seconds
  Elapsed time:      2.76 seconds
  Pagefaults:         197
  I/O Count:           14
